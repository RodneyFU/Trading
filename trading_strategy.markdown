# 詳細交易策略概述

## 策略目標
本策略專為 USD/JPY 貨幣對設計，旨在通過多時間框架分析、技術指標、機器學習預測和嚴格風險管理，最大化投資收益。策略適應高波動（如東京/倫敦市場重疊）和低波動環境，透過動態訂單類型和模型權重調整，捕捉快速收益並控制風險，實現穩定獲利。

## 核心交易邏輯
- **多時間框架分析**：
  - **1 小時**：捕捉短期價格波動，使用 XGBoost 模型預測下一小時價格，適合快速交易（如突破布林帶上軌）。
  - **4 小時**：平衡趨勢與波動，隨機森林模型確認中期趨勢，過濾短期噪音。
  - **日線**：捕捉長期趨勢，LSTM 模型確保交易與大方向一致。
- **技術指標**：
  - **RSI（相對強弱指數）**：超買（>70，賣出信號）、超賣（<30，買入信號）。
  - **MACD（移動平均收斂-發散）**：金叉（買入）、死叉（賣出），檢測趨勢反轉。
  - **ATR（平均真實波幅）**：動態設置止損（2 倍 ATR）、止盈（3 倍 ATR）。
  - **布林帶**：突破上軌買入、下軌賣出，標準差 2，週期 20。
  - **隨機指標（STOCH）**：超買（>80）、超賣（<20），參數 K=14、D=3、平滑=3。
  - **ADX（平均方向性指數）**：>25 表示強趨勢，確保順勢交易。
  - **斐波那契回撤**：提供支撐（0.382、0.618）和阻力位。
  - **一目均衡表**：雲層上方買入、下方賣出，綜合趨勢判斷。
  - **EMA（指數移動平均線）**：20 週期（短期）、50 週期（中期），金叉/死叉確認趨勢。
  - **OBV（成交量淨額）**：視窗 20，確認價格與成交量一致性。
- **機器學習預測**：
  - XGBoost（短期）、隨機森林（中期）、LSTM（長期）結合預測。
  - 動態權重：高波動時短期模型 50%，低波動時長期模型 50%。
  - 價格偏差閾值：高波動 0.5%，低波動 0.04%。
- **交易信號生成**：
  - **買入**：RSI < 30、MACD 金叉、OBV 上行、ADX > 25、一目均衡表看漲，且預測價格 > 當前價格 + 閾值。
  - **賣出**：RSI > 70、MACD 死叉、OBV 下行、ADX > 25、一目均衡表看跌，且預測價格 < 當前價格 - 閾值。
  - 至少 3 指標確認，結合經濟事件過濾。
- **訂單類型**：
  - **高波動時段**（8-12、20-24 UTC）：市場單，快速成交。
  - **低波動時段**：限價單，偏移 0.0002，控制滑點。
  - 括號訂單：主訂單 + 止損 + 止盈，超時 900 秒取消。

## 風險管理
- **止損/止盈**：ATR 動態設置（止損 2 倍，止盈 3 倍），風險回報比 1:1.5。
- **跟蹤止損**：高波動時 1.5 倍 ATR，鎖定利潤。
- **連續虧損**：>3 次暫停 24 小時。
- **Sortino 比率**：<1.5 暫停，控制下行風險。
- **滑點**：允許 0.002。
- **持倉時間**：高波動 24 小時，低波動 72 小時。
- **經濟事件**：高影響事件（如非農、FOMC）前後 24 小時暫停。

## 數據來源
- **歷史數據**：SQLite > Yahoo Finance > FMP API。
- **即時價格**：Interactive Brokers > Alpha Vantage > FMP > Yahoo。
- **經濟事件**：FMP API > 本地 CSV。

## 收益最大化設計
- **動態訂單**：市場單/限價單切換，平衡速度與成本。
- **多模型預測**：提高準確率 15-20%。
- **多時間框架**：減少假信號 30%。
- **快取/資料庫**：降低 API 請求 50%，提升效率。
- **並行計算**：加速指標計算，支援高頻數據。

## 適用場景
- **回測**：模擬歷史交易，優化參數，評估表現。
- **實盤**：適應市場變化，追求年化收益 20%+，控制風險。